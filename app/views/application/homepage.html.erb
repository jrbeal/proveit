<html xmlns="http://www.w3.org/1999/html">
	<head>
		<script type="text/javascript">

			var verbosity = <%= current_prover.verbosity %>

			$(function() {
				$('#lessmaster').on("click", function () {
					if (verbosity > 1) {
						verbosity -= 1;
					}

					switch (verbosity) {
						case 3:
							$('.vlevelindicator3').show();
							$('.vlevelindicator4').hide();
							$('.vlevel4').fadeOut();
							break;
						case 2:
							$('.vlevelindicator2').show();
							$('.vlevelindicator3').hide();
							$('.postimage').fadeOut();
							$('.vlevel3').fadeOut();
							break;
						case 1:
						default:
							$('.vlevelindicator1').show();
							$('.vlevelindicator2').hide();
							$('.vlevel2').fadeOut();
							break;
					}

					console.log("verbosity level is now " + verbosity)
				});

				$('#moremaster').on("click", function () {

					if (verbosity < 4) {
						verbosity += 1;
					}

					switch (verbosity) {
						case 4:
							$('.vlevelindicator3').hide();
							$('.vlevelindicator4').show();
							$('.vlevel4').fadeIn();
							break;
						case 3:
							$('.vlevelindicator2').hide();
							$('.vlevelindicator3').show();
							$('.postimage').fadeIn();
							$('.vlevel3').fadeIn();
							break;
						case 2:
						default:
							$('.vlevelindicator1').hide();
							$('.vlevelindicator2').show();
							$('.vlevel2').fadeIn();
							break;
					}

					console.log("verbosity level is now " + verbosity)
				});

				$('#lesspost').on("click", function () {
					console.log("Decreasing post verbosity.");
				});

				$('#morepost').on("click", function () {
					console.log("Increasing post verbosity.");
				});

				$('.follow').on("click", function (e) {
					var $tgt = $(e.target);
					$.post('/follows', {owner: <%= current_prover.id %>, follows: $tgt.attr("data-prover-id") }, function(resp) {
						var follow = JSON.parse(resp);
						console.log(follow);
					});

					console.log("Following this prover.");
					window.location.reload();
					return false;
				});

				$('.unfollow').on("click", function (e) {
					var $tgt = $(e.target);
					$.ajax({
						url: '/follows?' + $.param({"owner": <%= current_prover.id %>, "follows": $tgt.attr("data-prover-id")}),
						type: 'DELETE',
						success: function(resp) {
							console.log("Unfollowing this prover.");
							window.location.reload();
						}
					})

					return false;
				});

				$('.bookmark').on("click", function (e) {
					var $tgt = $(e.target);
					$.post('/bookmarks', {owner: <%= current_prover.id %>, post: $tgt.attr("data-post") }, function(resp) {
						var follow = JSON.parse(resp);
						console.log(follow);
					});

					console.log("Bookmarking this post.");
					window.location.reload();
					return false;
				});

				$('.unbookmark').on("click", function (e) {
					var $tgt = $(e.target);
					$.ajax({
						url: '/bookmarks?' + $.param({"owner": <%= current_prover.id %>, "post": $tgt.attr("data-post")}),
						type: 'DELETE',
						success: function(resp) {
							console.log("Removing this bookmark.");
							window.location.reload();
						}
					})

					return false;
				});

				$(function () {
					switch (verbosity) {
						case 4:
							console.log("Showing verbosity level 4.");
							$('.vlevelindicator1').hide();
							$('.vlevelindicator2').hide();
							$('.vlevelindicator3').hide();
							$('.vlevelindicator4').show();
							$('.vlevel1').show();
							$('.vlevel2').show();
							$('.vlevel3').show();
							$('.vlevel4').show();
							$('.postimage').show();
							break;
						case 3:
							console.log("Showing verbosity level 3.");
							$('.vlevelindicator1').hide();
							$('.vlevelindicator2').hide();
							$('.vlevelindicator3').show();
							$('.vlevelindicator4').hide();
							$('.vlevel1').show();
							$('.vlevel2').show();
							$('.vlevel3').show();
							$('.vlevel4').hide();
							$('.postimage').show();
							break;
						case 2:
							console.log("Showing verbosity level 2.");
							$('.vlevelindicator1').hide();
							$('.vlevelindicator2').show();
							$('.vlevelindicator3').hide();
							$('.vlevelindicator4').hide();
							$('.vlevel1').show();
							$('.vlevel2').show();
							$('.vlevel3').hide();
							$('.vlevel4').hide();
							$('.postimage').hide();
							break;
						case 1:
						default:
							console.log("Showing verbosity level 1.");
							$('.vlevelindicator1').show();
							$('.vlevelindicator2').hide();
							$('.vlevelindicator3').hide();
							$('.vlevelindicator4').hide();
							$('.vlevel1').show();
							$('.vlevel2').hide();
							$('.vlevel3').hide();
							$('.vlevel4').hide();
							$('.postimage').hide();
					}
				});

			});
		</script>
	</head>

	<body>
		<div class="mainbody">
			<div class="sidepadding spacing">
				<%= link_to 'Create', posts_new_path %>
				<div style="display:inline; margin-left: 40%">
					Filter: <%= link_to current_prover.filter.capitalize, prover_path(current_prover, :default_tab => "filters") %>
				</div>
				<div class="right" style="margin-right: 5px;">
					<%= link_to "Less", "#", :id => "lessmaster"%>
					<span class="vlevelindicator1"><1></span>
					<span class="vlevelindicator2"><2></span>
					<span class="vlevelindicator3"><3></span>
					<span class="vlevelindicator4"><4></span>
					<%= link_to "More", "#", :id => "moremaster"%>
				</div>
			</div>

			<div class="toppadding10">
				<% @posts.each do |post| %>
					<div class="post <%= status_color(post) %>">
						<%= link_to image_tag(post.prover.image_url, :class => "postimage"), post.prover %>
						<div class="vlevel2 sidepadding">
							<% tmp = post.prover.provername.downcase + " (" + post.prover.first_name + " " + post.prover.last_name + ")" %>
							<%= link_to tmp, post.prover %>, &nbsp
							<%= post.prover.rating.round(2) %>, &nbsp
							<% if already_following(post.prover.id) %>
								<%= link_to "Unfollow", "#", :class => "unfollow", :data => {:prover_id => "#{post.prover.id}"} %>
							<% else %>
								<%= link_to "Follow", "#", :class => "follow", :data => {:prover_id => "#{post.prover.id}"} %>
							<% end %>
							<div class="right">
								<%= post.created_at.strftime("%c") %>
							</div>
						</div>

						<div class="vlevel1 sidepadding">
							<% if !post.url.empty? %>
								<span><%= link_to image_tag('link3.png', :size => '12x12'), post.url %></span>
							<% end %> &nbsp
							<em><span class="message">
								<%= link_to post.message, post, {:style=>'color:blue;'} %>
							</span></em>
							<div class="right spacing">
								<%= link_to "Less", "#", :id => "lesspost"%>
								<span class="vlevelindicator1"><1></span>
								<span class="vlevelindicator2"><2></span>
								<span class="vlevelindicator3"><3></span>
								<span class="vlevelindicator4"><4></span>
								<%= link_to "More", "#", :id => "morepost"%>
							</div>
						</div>

						<div class="vlevel3 sidepadding">
							<%= offspring(post) %> &nbsp
							<%= post.views %> views, &nbsp
							<%= level(post) %> &nbsp
							<% if already_bookmarked(post) %>
								<%= link_to "Unbookmark", "#", :class => "unbookmark", :data => {:post => "#{post.id}"} %>
							<% else %>
								<%= link_to "Bookmark", "#", :class => "bookmark", :data => {:post => "#{post.id}"} %>
							<% end %>
							<div class="right">
								<%= post.updated_at.strftime("%c") %>
							</div>
						</div>

						<% if !post.support.empty? %>
							<div class="vlevel4 sidepadding">
								<em><%= post.support %></em>
							</div>
						<% end %>
					</div>
				<% end %>
			</div>
		</div>
	</body>
</html>
